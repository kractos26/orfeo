<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
		<title>calendar.js Source File</title>
		<link href="doxygen.css" rel="stylesheet" type="text/css">
		<link href="../../css/template.css" rel="stylesheet" type="text/css">
		<link href="../../css/zpcal.css" rel="stylesheet" type="text/css">
		</head><body>
		<div class="topMenuHeader"> 
			<div class="logo">
				<a href='http://www.zapatec.com/website/main/support.jsp'><img src='/website/main/images/logoNew.gif' alt='Zapatec Javascript Calendar' border='0' align='middle'></a>
				<span class='zpCalHeader'>
					DHTML Calendar Javascript Source Code Documentation
				</span>
			</div>
		</div>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>calendar.js</h1><a href="calendar_8js.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * The Zapatec DHTML Calendar</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (c) 2004 by Zapatec, Inc.</span>
00005 <span class="comment"> * http://www.zapatec.com</span>
00006 <span class="comment"> * 1700 MLK Way, Berkeley, California,</span>
00007 <span class="comment"> * 94709, U.S.A.</span>
00008 <span class="comment"> * All rights reserved.</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Main Calendar file. Creates a popup or flat calendar with various options.</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * Original version written by Mihai Bazon,</span>
00013 <span class="comment"> * http://www.bazon.net/mishoo/calendar.epl</span>
00014 <span class="comment"> */</span>
00015 
00016 <span class="comment">// $Id: calendar.js,v 1.10 2005/03/04 23:14:15 dror Exp $</span>
00017 
<a name="l00043"></a><a class="code" href="calendar_8js.html#a0">00043</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar = function (firstDayOfWeek, dateStr, onSelected, onClose) {
00044         <span class="comment">// member variables</span>
00045         <span class="keyword">this</span>.activeDiv = null;
00046         <span class="keyword">this</span>.currentDateEl = null;
00047         <span class="keyword">this</span>.getDateStatus = null;
00048         <span class="keyword">this</span>.getDateToolTip = null;
00049         <span class="keyword">this</span>.getDateText = null;
00050         <span class="keyword">this</span>.timeout = null;
00051         <span class="keyword">this</span>.onSelected = onSelected || null;
00052         <span class="keyword">this</span>.onClose = onClose || null;
00053         <span class="keyword">this</span>.onFDOW = null;
00054         <span class="keyword">this</span>.dragging = <span class="keyword">false</span>;
00055         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
00056         <span class="keyword">this</span>.minYear = 1970;
00057         <span class="keyword">this</span>.maxYear = 2050;
00058         <span class="keyword">this</span>.minMonth = 0;
00059         <span class="keyword">this</span>.maxMonth = 11;
00060         <span class="keyword">this</span>.dateFormat = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DEF_DATE_FORMAT"</span>);
00061         <span class="keyword">this</span>.ttDateFormat = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TT_DATE_FORMAT"</span>);
00062         <span class="keyword">this</span>.historyDateFormat = <span class="stringliteral">"%B %d, %Y"</span>;
00063         <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
00064         <span class="keyword">this</span>.weekNumbers = <span class="keyword">true</span>;
00065         <span class="keyword">this</span>.noGrab = <span class="keyword">false</span>;
00066         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow || (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow == 0)) {
00067                 <span class="keyword">this</span>.firstDayOfWeek = parseInt(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow, 10);
00068         }
00069         <span class="keywordflow">else</span> {
00070                 var fd = 0;
00071                 <span class="keywordflow">if</span> (typeof firstDayOfWeek == <span class="stringliteral">"number"</span>) {
00072                         fd = firstDayOfWeek;
00073                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._FD == 'number') {
00074                         fd = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._FD;
00075                 }
00076                 <span class="keyword">this</span>.firstDayOfWeek = fd;
00077         }
00078         <span class="keyword">this</span>.showsOtherMonths = <span class="keyword">false</span>;
00079         <span class="keyword">this</span>.dateStr = dateStr;
00080         <span class="keyword">this</span>.ar_days = null;
00081         <span class="keyword">this</span>.showsTime = <span class="keyword">false</span>;
00082         <span class="keyword">this</span>.time24 = <span class="keyword">true</span>;
00083         <span class="keyword">this</span>.yearStep = 2;
00084         <span class="keyword">this</span>.hiliteToday = <span class="keyword">true</span>;
00085         <span class="keyword">this</span>.multiple = null;
00086         <span class="comment">// HTML elements</span>
00087         <span class="keyword">this</span>.table = null;
00088         <span class="keyword">this</span>.element = null;
00089         <span class="keyword">this</span>.tbody = null;
00090         <span class="keyword">this</span>.firstdayname = null;
00091         <span class="comment">// Combo boxes</span>
00092         <span class="keyword">this</span>.monthsCombo = null;   <span class="comment">// months</span>
00093         <span class="keyword">this</span>.hilitedMonth = null;
00094         <span class="keyword">this</span>.activeMonth = null;
00095         <span class="keyword">this</span>.yearsCombo = null;    <span class="comment">// years</span>
00096         <span class="keyword">this</span>.hilitedYear = null;
00097         <span class="keyword">this</span>.activeYear = null;
00098         <span class="keyword">this</span>.histCombo = null;     <span class="comment">// history</span>
00099         <span class="keyword">this</span>.hilitedHist = null;
00100         <span class="comment">// Information</span>
00101         <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
00102 
00103         <span class="comment">// one-time initializations</span>
00104         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._initSDN();
00105 };
00106 
<a name="l00113"></a><a class="code" href="calendar_8js.html#a1">00113</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._initSDN = function() {
00114         <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN == <span class="stringliteral">"undefined"</span>) {
00115                 <span class="comment">// table of short day names</span>
00116                 <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len == <span class="stringliteral">"undefined"</span>)
00117                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len = 3;
00118                 var ar = [];
00119                 <span class="keywordflow">for</span> (var i = 8; i &gt; 0;) {
00120                         ar[--i] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._DN[i].substr(0, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len);
00121                 }
00122                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN = ar;
00123                 <span class="comment">// table of short month names</span>
00124                 <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len == <span class="stringliteral">"undefined"</span>)
00125                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len = 3;
00126                 ar = [];
00127                 <span class="keywordflow">for</span> (var i = 12; i &gt; 0;) {
00128                         ar[--i] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._MN[i].substr(0, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len);
00129                 }
00130                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN = ar;
00131         }
00132 };
00133 
<a name="l00155"></a><a class="code" href="calendar_8js.html#a2">00155</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n = function(str, type) {
00156         var tr = '';
00157         <span class="keywordflow">if</span> (!type) {
00158                 <span class="comment">// normal _TT request</span>
00159                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT)
00160                         tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT[str];
00161                 <span class="keywordflow">if</span> (!tr &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT_en)
00162                         tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT_en[str];
00163         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(type) {
00164             <span class="keywordflow">case</span> <span class="stringliteral">"dn"</span>  : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._DN[str];  <span class="keywordflow">break</span>;
00165             <span class="keywordflow">case</span> <span class="stringliteral">"sdn"</span> : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN[str]; <span class="keywordflow">break</span>;
00166             <span class="keywordflow">case</span> <span class="stringliteral">"mn"</span>  : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._MN[str];  <span class="keywordflow">break</span>;
00167             <span class="keywordflow">case</span> <span class="stringliteral">"smn"</span> : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN[str]; <span class="keywordflow">break</span>;
00168         }
00169         <span class="keywordflow">if</span> (!tr) tr = <span class="stringliteral">""</span> + str;
00170         <span class="keywordflow">return</span> tr;
00171 };
00172 
00173 <span class="comment">// ** constants</span>
00174 
<a name="l00176"></a><a class="code" href="calendar_8js.html#a3">00176</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
00177 
<a name="l00179"></a><a class="code" href="calendar_8js.html#a4">00179</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs = {
00180         fdow     : null,        
00181         history  : <span class="stringliteral">""</span>,          
00182         hsize    : 9            
00183 };
00184 
00185 <span class="comment">// BEGIN: CALENDAR STATIC FUNCTIONS</span>
00186 
<a name="l00190"></a><a class="code" href="calendar_8js.html#a5">00190</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs = function() {
00191         <span class="comment">// FIXME: should we make the domain, path and expiration time configurable?</span>
00192         <span class="comment">// I guess these defaults are right though..</span>
00193         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.writeCookie(<span class="stringliteral">"DYN_CAL"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.makePref(<span class="keyword">this</span>.prefs), null, <span class="charliteral">'/'</span>, 30);
00194 };
00195 
<a name="l00199"></a><a class="code" href="calendar_8js.html#a6">00199</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.loadPrefs = function() {
00200         var txt = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getCookie(<span class="stringliteral">"DYN_CAL"</span>), tmp;
00201         <span class="keywordflow">if</span> (txt) {
00202                 tmp = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.loadPref(txt);
00203                 <span class="keywordflow">if</span> (tmp)
00204                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.mergeObjects(<span class="keyword">this</span>.<a class="code" href="calendar_8js.html#a4">prefs</a>, tmp);
00205         }
00206         <span class="comment">// FIXME: DEBUG!</span>
00207         <span class="comment">//this.prefs.history = "1979/03/08,1976/12/28,1978/08/31,1998/09/21";</span>
00208         <span class="comment">//this.prefs.history = null;</span>
00209 };
00210 
<a name="l00216"></a><a class="code" href="calendar_8js.html#a7">00216</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs = function(el) {
00217         var C = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar;
00218         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00219         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00220         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00221         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00222                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00223 };
00224 
<a name="l00231"></a><a class="code" href="calendar_8js.html#a8">00231</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._del_evs = function(el) {
00232         var C = <span class="keyword">this</span>;
00233         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00234         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00235         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00236         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00237                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00238 };
00239 
<a name="l00247"></a><a class="code" href="calendar_8js.html#a9">00247</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth = function(el) {
00248         <span class="keywordflow">if</span> (typeof el.month != <span class="stringliteral">"undefined"</span>) {
00249                 <span class="keywordflow">return</span> el;
00250         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.month != <span class="stringliteral">"undefined"</span>) {
00251                 <span class="keywordflow">return</span> el.parentNode;
00252         }
00253         <span class="keywordflow">return</span> null;
00254 };
00255 
<a name="l00257"></a><a class="code" href="calendar_8js.html#a10">00257</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist = function(el) {
00258         <span class="keywordflow">if</span> (typeof el.histDate != <span class="stringliteral">"undefined"</span>) {
00259                 <span class="keywordflow">return</span> el;
00260         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.histDate != <span class="stringliteral">"undefined"</span>) {
00261                 <span class="keywordflow">return</span> el.parentNode;
00262         }
00263         <span class="keywordflow">return</span> null;
00264 };
00265 
<a name="l00267"></a><a class="code" href="calendar_8js.html#a11">00267</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear = function(el) {
00268         <span class="keywordflow">if</span> (typeof el.year != <span class="stringliteral">"undefined"</span>) {
00269                 <span class="keywordflow">return</span> el;
00270         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.year != <span class="stringliteral">"undefined"</span>) {
00271                 <span class="keywordflow">return</span> el.parentNode;
00272         }
00273         <span class="keywordflow">return</span> null;
00274 };
00275 
<a name="l00281"></a><a class="code" href="calendar_8js.html#a12">00281</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showMonthsCombo = function () {
00282         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00283         <span class="keywordflow">if</span> (!cal) {
00284                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00285         }
00286         var cd = cal.activeDiv;
00287         var mc = cal.monthsCombo;
00288         var date = cal.date,
00289                 MM = cal.date.getMonth(),
00290                 YY = cal.date.getFullYear(),
00291                 min = (YY == cal.minYear),
00292                 max = (YY == cal.maxYear);
00293         <span class="keywordflow">for</span> (var i = mc.firstChild; i; i = i.nextSibling) {
00294                 var m = i.month;
00295                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"hilite"</span>);
00296                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"active"</span>);
00297                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"disabled"</span>);
00298                 i.disabled = <span class="keyword">false</span>;
00299                 <span class="keywordflow">if</span> ((min &amp;&amp; m &lt; cal.minMonth) ||
00300                     (max &amp;&amp; m &gt; cal.maxMonth)) {
00301                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(i, <span class="stringliteral">"disabled"</span>);
00302                         i.disabled = <span class="keyword">true</span>;
00303                 }
00304                 <span class="keywordflow">if</span> (m == MM)
00305                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cal.activeMonth = i, <span class="stringliteral">"active"</span>);
00306         }
00307         var s = mc.style;
00308         s.display = <span class="stringliteral">"block"</span>;
00309         <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00310                 s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00311         <span class="keywordflow">else</span> {
00312                 var mcw = mc.offsetWidth;
00313                 <span class="keywordflow">if</span> (typeof mcw == <span class="stringliteral">"undefined"</span>)
00314                         <span class="comment">// Konqueror brain-dead techniques</span>
00315                         mcw = 50;
00316                 s.left = (cd.offsetLeft + cd.offsetWidth - mcw) + <span class="stringliteral">"px"</span>;
00317         }
00318         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00319         cal.updateWCH(mc);
00320 };
00321 
<a name="l00326"></a><a class="code" href="calendar_8js.html#a13">00326</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showHistoryCombo = function() {
00327         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C, a, h, i, cd, hc, s, tmp, div;
00328         <span class="keywordflow">if</span> (!cal)
00329                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00330         hc = cal.histCombo;
00331         <span class="keywordflow">while</span> (hc.firstChild)
00332                 hc.removeChild(hc.lastChild);
00333         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
00334                 a = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history.split(/,/);
00335                 i = 0;
00336                 <span class="keywordflow">while</span> (tmp = a[i++]) {
00337                         tmp = tmp.split(/\<span class="comment">//);</span>
00338                         h = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
00339                         h.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
00340                         h.histDate = <span class="keyword">new</span> Date(parseInt(tmp[0], 10), parseInt(tmp[1], 10)-1, parseInt(tmp[2], 10),
00341                                               tmp[3] ? parseInt(tmp[3], 10) : 0,
00342                                               tmp[4] ? parseInt(tmp[4], 10) : 0);
00343                         h.appendChild(window.document.createTextNode(h.histDate.print(cal.historyDateFormat)));
00344                         hc.appendChild(h);
00345                         <span class="keywordflow">if</span> (h.histDate.dateEqualsTo(cal.date))
00346                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(h, <span class="stringliteral">"active"</span>);
00347                 }
00348         }
00349         cd = cal.activeDiv;
00350         s = hc.style;
00351         s.display = <span class="stringliteral">"block"</span>;
00352         s.left = Math.floor(cd.offsetLeft + (cd.offsetWidth-hc.offsetWidth)/2) + <span class="stringliteral">"px"</span>;
00353         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00354         cal.updateWCH(hc);
00355 };
00356 
<a name="l00364"></a><a class="code" href="calendar_8js.html#a14">00364</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showYearsCombo = function (fwd) {
00365         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00366         <span class="keywordflow">if</span> (!cal) {
00367                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00368         }
00369         var cd = cal.activeDiv;
00370         var yc = cal.yearsCombo;
00371         <span class="keywordflow">if</span> (cal.hilitedYear) {
00372                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00373         }
00374         <span class="keywordflow">if</span> (cal.activeYear) {
00375                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.activeYear, <span class="stringliteral">"active"</span>);
00376         }
00377         cal.activeYear = null;
00378         var Y = cal.date.getFullYear() + (fwd ? 1 : -1);
00379         var yr = yc.firstChild;
00380         var <a class="code" href="calendar_8js.html#a45">show</a> = <span class="keyword">false</span>;
00381         <span class="keywordflow">for</span> (var i = 12; i &gt; 0; --i) {
00382                 <span class="keywordflow">if</span> (Y &gt;= cal.minYear &amp;&amp; Y &lt;= cal.maxYear) {
00383                         yr.firstChild.data = Y;
00384                         yr.year = Y;
00385                         yr.style.display = <span class="stringliteral">"block"</span>;
00386                         <a class="code" href="calendar_8js.html#a45">show</a> = <span class="keyword">true</span>;
00387                 } <span class="keywordflow">else</span> {
00388                         yr.style.display = <span class="stringliteral">"none"</span>;
00389                 }
00390                 yr = yr.nextSibling;
00391                 Y += fwd ? cal.yearStep : -cal.yearStep;
00392         }
00393         <span class="keywordflow">if</span> (<a class="code" href="calendar_8js.html#a45">show</a>) {
00394                 var s = yc.style;
00395                 s.display = <span class="stringliteral">"block"</span>;
00396                 <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00397                         s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00398                 <span class="keywordflow">else</span> {
00399                         var ycw = yc.offsetWidth;
00400                         <span class="keywordflow">if</span> (typeof ycw == <span class="stringliteral">"undefined"</span>)
00401                                 <span class="comment">// Konqueror brain-dead techniques</span>
00402                                 ycw = 50;
00403                         s.left = (cd.offsetLeft + cd.offsetWidth - ycw) + <span class="stringliteral">"px"</span>;
00404                 }
00405                 s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00406         }
00407         cal.updateWCH(yc);
00408 };
00409 
00410 <span class="comment">// event handlers</span>
00411 
<a name="l00435"></a><a class="code" href="calendar_8js.html#a15">00435</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp = function(ev) {
00436         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00437         <span class="keywordflow">if</span> (!cal) {
00438                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00439         }
00440         <span class="keywordflow">if</span> (cal.timeout) {
00441                 clearTimeout(cal.timeout);
00442         }
00443         var el = cal.activeDiv;
00444         <span class="keywordflow">if</span> (!el) {
00445                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00446         }
00447         var target = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
00448         ev || (ev = window.event);
00449         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00450         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00451                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(el, ev);
00452         }
00453         var mon = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth(target);
00454         var date = null;
00455         <span class="keywordflow">if</span> (mon) {
00456                 <span class="keywordflow">if</span> (!mon.disabled) {
00457                         date = <span class="keyword">new</span> Date(cal.date);
00458                         <span class="keywordflow">if</span> (mon.month != date.getMonth()) {
00459                                 date.setMonth(mon.month);
00460                                 cal.setDate(date);
00461                                 cal.dateClicked = <span class="keyword">false</span>;
00462                                 cal.callHandler();
00463                         }
00464                 }
00465         } <span class="keywordflow">else</span> {
00466                 var year = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear(target);
00467                 <span class="keywordflow">if</span> (year) {
00468                         date = <span class="keyword">new</span> Date(cal.date);
00469                         <span class="keywordflow">if</span> (year.year != date.getFullYear()) {
00470                                 date.setFullYear(year.year);
00471                                 cal.setDate(date);
00472                                 cal.dateClicked = <span class="keyword">false</span>;
00473                                 cal.callHandler();
00474                         }
00475                 } <span class="keywordflow">else</span> {
00476                         var hist = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist(target);
00477                         <span class="keywordflow">if</span> (hist &amp;&amp; !hist.histDate.dateEqualsTo(cal.date)) {
00478                                 <span class="comment">//(date = new Date(cal.date)).setDateOnly(hist.histDate);</span>
00479                                 date = <span class="keyword">new</span> Date(hist.histDate);
00480                                 cal._init(cal.firstDayOfWeek, cal.date = date);
00481                                 cal.dateClicked = <span class="keyword">false</span>;
00482                                 cal.callHandler();
00483                                 cal.updateHistory();
00484                         }
00485                 }
00486         }
00487         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp);
00488         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00489         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00490         cal._hideCombos();
00491         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
00492         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00493 };
00494 
<a name="l00510"></a><a class="code" href="calendar_8js.html#a16">00510</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver = function (ev) {
00511         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00512         <span class="keywordflow">if</span> (!cal) {
00513                 <span class="keywordflow">return</span>;
00514         }
00515         var el = cal.activeDiv;
00516         var target = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
00517         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00518                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);
00519                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00520         } <span class="keywordflow">else</span> {
00521                 <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span> ||
00522                     (el.navtype != 50 &amp;&amp; ((el.navtype == 0 &amp;&amp; !cal.histCombo) || Math.abs(el.navtype) &gt; 2)))
00523                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00524                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00525                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00526         }
00527         ev || (ev = window.event);
00528         <span class="keywordflow">if</span> (el.navtype == 50 &amp;&amp; target != el) {
00529                 var pos = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
00530                 var w = el.offsetWidth;
00531                 var x = ev.clientX;
00532                 var dx;
00533                 var decrease = <span class="keyword">true</span>;
00534                 <span class="keywordflow">if</span> (x &gt; pos.x + w) {
00535                         dx = x - pos.x - w;
00536                         decrease = <span class="keyword">false</span>;
00537                 } <span class="keywordflow">else</span>
00538                         dx = pos.x - x;
00539 
00540                 <span class="keywordflow">if</span> (dx &lt; 0) dx = 0;
00541                 var range = el._range;
00542                 var current = el._current;
00543                 var count = Math.floor(dx / 10) % range.length;
00544                 <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00545                         <span class="keywordflow">if</span> (range[i] == current)
00546                                 <span class="keywordflow">break</span>;
00547                 <span class="keywordflow">while</span> (count-- &gt; 0)
00548                         <span class="keywordflow">if</span> (decrease) {
00549                                 <span class="keywordflow">if</span> (--i &lt; 0)
00550                                         i = range.length - 1;
00551                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length )
00552                                 i = 0;
00553                 el.firstChild.data = range[i];
00554 
00555                 cal.onUpdateTime();
00556         }
00557         var mon = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth(target);
00558         <span class="keywordflow">if</span> (mon) {
00559                 <span class="keywordflow">if</span> (!mon.disabled) {
00560                         <span class="keywordflow">if</span> (mon.month != cal.date.getMonth()) {
00561                                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00562                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00563                                 }
00564                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(mon, <span class="stringliteral">"hilite"</span>);
00565                                 cal.hilitedMonth = mon;
00566                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedMonth) {
00567                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00568                         }
00569                 }
00570         } <span class="keywordflow">else</span> {
00571                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00572                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00573                 }
00574                 var year = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear(target);
00575                 <span class="keywordflow">if</span> (year) {
00576                         <span class="keywordflow">if</span> (year.year != cal.date.getFullYear()) {
00577                                 <span class="keywordflow">if</span> (cal.hilitedYear) {
00578                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00579                                 }
00580                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(year, <span class="stringliteral">"hilite"</span>);
00581                                 cal.hilitedYear = year;
00582                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedYear) {
00583                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00584                         }
00585                 } <span class="keywordflow">else</span> {
00586                         <span class="keywordflow">if</span> (cal.hilitedYear) {
00587                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00588                         }
00589                         var hist = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist(target);
00590                         <span class="keywordflow">if</span> (hist) {
00591                                 <span class="keywordflow">if</span> (!hist.histDate.dateEqualsTo(cal.date)) {
00592                                         <span class="keywordflow">if</span> (cal.hilitedHist) {
00593                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00594                                         }
00595                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(hist, <span class="stringliteral">"hilite"</span>);
00596                                         cal.hilitedHist = hist;
00597                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00598                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00599                                 }
00600                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00601                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00602                         }
00603                 }
00604         }
00605         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00606 };
00607 
<a name="l00616"></a><a class="code" href="calendar_8js.html#a17">00616</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseDown = function (ev) {
00617         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev) == <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev)) {
00618                 <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00619         }
00620 };
00621 
<a name="l00636"></a><a class="code" href="group__dndmove.html#ga0">00636</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt = function (ev) {
00637         ev || (ev = window.event);
00638         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00639         <span class="keywordflow">if</span> (!(cal &amp;&amp; cal.dragging)) {
00640                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00641         }
00642         var posX = ev.clientX + window.document.body.scrollLeft;
00643         var posY = ev.clientY + window.document.body.scrollTop;
00644         cal.hideShowCovered();
00645         var st = cal.element.style, L = posX - cal.xOffs, T = posY - cal.yOffs;
00646         st.left = L + <span class="stringliteral">"px"</span>;
00647         st.top = T + <span class="stringliteral">"px"</span>;
00648         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.setupWCH(cal.WCH, L, T);
00649         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00650 };
00651 
<a name="l00663"></a><a class="code" href="group__dndmove.html#ga1">00663</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd = function (ev) {
00664         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00665         <span class="keywordflow">if</span> (!cal) {
00666                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00667         }
00668         cal.dragging = <span class="keyword">false</span>;
00669         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
00670         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
00671         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd);
00672         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp(ev);
00673         cal.hideShowCovered();
00674 };
00676 
<a name="l00693"></a><a class="code" href="calendar_8js.html#a20">00693</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseDown = function(ev) {
00694         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev);
00695         <span class="keywordflow">if</span> (el.disabled) {
00696                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00697         }
00698         var cal = el.calendar;
00699         cal.activeDiv = el;
00700         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = cal;
00701         <span class="keywordflow">if</span> (el.navtype != 300) {
00702                 <span class="keywordflow">if</span> (el.navtype == 50) {
00703                         el._current = el.firstChild.data;
00704                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00705                 } <span class="keywordflow">else</span>
00706                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5 ? <span class="stringliteral">"mousemove"</span> : <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00707                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);
00708                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp);
00709         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.isPopup) {
00710                 cal._dragStart(ev);
00711         }
00712         <span class="keywordflow">if</span> (el.navtype == -1 || el.navtype == 1) {
00713                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00714                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showMonthsCombo()"</span>, 250);
00715         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == -2 || el.navtype == 2) {
00716                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00717                 cal.timeout = setTimeout((el.navtype &gt; 0) ? <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(true)"</span> : <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(false)"</span>, 250);
00718         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == 0 &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
00719                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00720                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showHistoryCombo()"</span>, 250);
00721         } <span class="keywordflow">else</span> {
00722                 cal.timeout = null;
00723         }
00724         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00725 };
00726 
<a name="l00732"></a><a class="code" href="calendar_8js.html#a21">00732</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseDblClick = function(ev) {
00733         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev), ev || window.event);
00734         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00735                 window.document.selection.empty();
00736 };
00737 
<a name="l00748"></a><a class="code" href="calendar_8js.html#a22">00748</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseOver = function(ev) {
00749         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev),
00750                 caldate = el.caldate;
00751         <span class="keywordflow">if</span> (caldate)
00752                 caldate = <span class="keyword">new</span> Date(caldate[0], caldate[1], caldate[2]);
00753         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.isRelated(el, ev) || <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C || el.disabled) {
00754                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00755         }
00756         <span class="keywordflow">if</span> (el.ttip) {
00757                 <span class="keywordflow">if</span> (el.ttip.substr(0, 1) == <span class="stringliteral">"_"</span>) {
00758                         el.ttip = caldate.print(el.calendar.ttDateFormat) + el.ttip.substr(1);
00759                 }
00760                 el.calendar.showHint(el.ttip);
00761         }
00762         <span class="keywordflow">if</span> (el.navtype != 300) {
00763                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite"</span>);
00764                 <span class="keywordflow">if</span> (caldate) {
00765                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00766                 }
00767         }
00768         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00769 };
00770 
<a name="l00779"></a><a class="code" href="calendar_8js.html#a23">00779</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseOut = function(ev) {
00780         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev);
00781         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.isRelated(el, ev) || <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C || el.disabled)
00782                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00783         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00784         <span class="keywordflow">if</span> (el.caldate)
00785                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00786         <span class="keywordflow">if</span> (el.calendar)
00787                 el.calendar.showHint(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>));
00788         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00789 };
00790 
<a name="l00828"></a><a class="code" href="calendar_8js.html#a24">00828</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick = function(el, ev) {
00829         var cal = el.calendar;
00830         var closing = <span class="keyword">false</span>;
00831         var newdate = <span class="keyword">false</span>;
00832         var date = null;
00833         <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span>) {
00834                 <span class="keywordflow">if</span> (cal.currentDateEl) {
00835                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.currentDateEl, <span class="stringliteral">"selected"</span>);
00836                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"selected"</span>);
00837                         closing = (cal.currentDateEl == el);
00838                         <span class="keywordflow">if</span> (!closing) {
00839                                 cal.currentDateEl = el;
00840                         }
00841                 }
00842                 cal.date.setDateOnly(<span class="keyword">new</span> Date(el.caldate[0], el.caldate[1], el.caldate[2]));
00843                 date = cal.date;
00844                 var other_month = !(cal.dateClicked = !el.otherMonth);
00845                 <span class="keywordflow">if</span> (!other_month &amp;&amp; cal.multiple)
00846                         cal._toggleMultipleDate(<span class="keyword">new</span> Date(date));
00847                 <span class="keywordflow">else</span>
00848                         newdate = <span class="keyword">true</span>;
00849                 <span class="comment">// a date was clicked</span>
00850                 <span class="keywordflow">if</span> (other_month)
00851                         cal._init(cal.firstDayOfWeek, date);
00852         } <span class="keywordflow">else</span> {
00853                 <span class="keywordflow">if</span> (el.navtype == 200) {
00854                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00855                         cal.callCloseHandler();
00856                         <span class="keywordflow">return</span>;
00857                 }
00858                 date = <span class="keyword">new</span> Date(cal.date);
00859                 <span class="keywordflow">if</span> (el.navtype == 0)
00860                         date.setDateOnly(<span class="keyword">new</span> Date()); <span class="comment">// TODAY</span>
00861                 <span class="comment">// unless "today" was clicked, we assume no date was clicked so</span>
00862                 <span class="comment">// the selected handler will know not to close the calenar when</span>
00863                 <span class="comment">// in single-click mode.</span>
00864                 <span class="comment">// cal.dateClicked = (el.navtype == 0);</span>
00865                 cal.dateClicked = <span class="keyword">false</span>;
00866                 var year = date.getFullYear();
00867                 var mon = date.getMonth();
00868                 function setMonth(m) {
00869                         var day = date.getDate();
00870                         var max = date.getMonthDays(m);
00871                         <span class="keywordflow">if</span> (day &gt; max) {
00872                                 date.setDate(max);
00873                         }
00874                         date.setMonth(m);
00875                 };
00876                 <span class="keywordflow">switch</span> (el.navtype) {
00877                     <span class="keywordflow">case</span> 400:
00878                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00879                         var text = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"ABOUT"</span>);
00880                         <span class="keywordflow">if</span> (typeof text != <span class="stringliteral">"undefined"</span>) {
00881                                 text += cal.showsTime ? <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"ABOUT_TIME"</span>) : <span class="stringliteral">""</span>;
00882                         } <span class="keywordflow">else</span> {
00883                                 <span class="comment">// FIXME: this should be removed as soon as lang files get updated!</span>
00884                                 text = <span class="stringliteral">"Help and about box text is not translated into this language.\n"</span> +
00885                                         <span class="stringliteral">"If you know this language and you feel generous please update\n"</span> +
00886                                         <span class="stringliteral">"the corresponding file in \"lang\" subdir to match calendar-en.js\n"</span> +
00887                                         <span class="stringliteral">"and send it back to &lt;support@zapatec.com&gt; to get it into the distribution  ;-)\n\n"</span> +
00888                                         <span class="stringliteral">"Thank you!\n"</span> +
00889                                         <span class="stringliteral">"http://www.zapatec.com\n"</span>;
00890                         }
00891                         alert(text);
00892                         <span class="keywordflow">return</span>;
00893                     <span class="keywordflow">case</span> -2:
00894                         <span class="keywordflow">if</span> (year &gt; cal.minYear) {
00895                                 date.setFullYear(year - 1);
00896                         }
00897                         <span class="keywordflow">break</span>;
00898                     <span class="keywordflow">case</span> -1:
00899                         <span class="keywordflow">if</span> (mon &gt; 0) {
00900                                 setMonth(mon - 1);
00901                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year-- &gt; cal.minYear) {
00902                                 date.setFullYear(year);
00903                                 setMonth(11);
00904                         }
00905                         <span class="keywordflow">break</span>;
00906                     <span class="keywordflow">case</span> 1:
00907                         <span class="keywordflow">if</span> (mon &lt; 11) {
00908                                 setMonth(mon + 1);
00909                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
00910                                 date.setFullYear(year + 1);
00911                                 setMonth(0);
00912                         }
00913                         <span class="keywordflow">break</span>;
00914                     <span class="keywordflow">case</span> 2:
00915                         <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
00916                                 date.setFullYear(year + 1);
00917                         }
00918                         <span class="keywordflow">break</span>;
00919                     <span class="keywordflow">case</span> 100:
00920                         cal.setFirstDayOfWeek(el.fdow);
00921                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow = cal.firstDayOfWeek;
00922                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs();
00923                         <span class="keywordflow">if</span> (cal.onFDOW)
00924                                 cal.onFDOW(cal.firstDayOfWeek);
00925                         <span class="keywordflow">return</span>;
00926                     <span class="keywordflow">case</span> 50:
00927                         var range = el._range;
00928                         var current = el.firstChild.data;
00929                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00930                                 <span class="keywordflow">if</span> (range[i] == current)
00931                                         <span class="keywordflow">break</span>;
00932                         <span class="keywordflow">if</span> (ev &amp;&amp; ev.shiftKey) {
00933                                 <span class="keywordflow">if</span> (--i &lt; 0)
00934                                         i = range.length - 1;
00935                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length )
00936                                 i = 0;
00937                         el.firstChild.data = range[i];
00938                         cal.onUpdateTime();
00939                         <span class="keywordflow">return</span>;
00940                     <span class="keywordflow">case</span> 201: <span class="comment">// timepart, UP</span>
00941                     <span class="keywordflow">case</span> 202: <span class="comment">// timepart, DOWN</span>
00942                         var cel = el.timePart;
00943                         var val = parseInt(cel.firstChild.data, 10);
00944                         var range = cel._range;
00945                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00946                                 <span class="keywordflow">if</span> (val == range[i]) {
00947                                         val = i;
00948                                         <span class="keywordflow">break</span>;
00949                                 }
00950                         var step = cel._step;
00951                         <span class="keywordflow">if</span> (el.navtype == 201) {
00952                                 val = step*Math.floor(val/step);
00953                                 val += step;
00954                                 <span class="keywordflow">if</span> (val &gt;= range.length)
00955                                         val = 0;
00956                         } <span class="keywordflow">else</span> {
00957                                 val = step*Math.ceil(val/step);
00958                                 val -= step;
00959                                 <span class="keywordflow">if</span> (val &lt; 0)
00960                                         val = range.length-1;
00961                         }
00962                         cel.firstChild.data = range[val];
00963                         cal.onUpdateTime();
00964                         <span class="keywordflow">return</span>;
00965                     <span class="keywordflow">case</span> 0:
00966                         <span class="comment">// TODAY will bring us here</span>
00967                         <span class="keywordflow">if</span> (cal.getDateStatus &amp;&amp; cal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate())) {
00968                                 <span class="comment">// remember, "date" was previously set to new</span>
00969                                 <span class="comment">// Date() if TODAY was clicked; thus, it</span>
00970                                 <span class="comment">// contains today date.</span>
00971                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00972                         }
00973                         <span class="keywordflow">break</span>;
00974                 }
00975                 <span class="keywordflow">if</span> (!date.equalsTo(cal.date)) {
00976                         cal.setDate(date);
00977                         newdate = <span class="keyword">true</span>;
00978                 }
00979         }
00980         <span class="keywordflow">if</span> (newdate) {
00981                 cal.callHandler();
00982         }
00983         <span class="keywordflow">if</span> (closing) {
00984                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00985                 cal.callCloseHandler();
00986         }
00987 };
00988 
00989 <span class="comment">// END: CALENDAR STATIC FUNCTIONS</span>
00990 
00991 <span class="comment">// BEGIN: CALENDAR OBJECT FUNCTIONS</span>
00992 
<a name="l01020"></a><a class="code" href="calendar_8js.html#a25">01020</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.create = function (_par) {
01021         var parent = null;
01022         <span class="keywordflow">if</span> (! _par) {
01023                 <span class="comment">// default parent is the document body, in which case we create</span>
01024                 <span class="comment">// a popup calendar.</span>
01025                 parent = window.document.getElementsByTagName(<span class="stringliteral">"body"</span>)[0];
01026                 <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
01027                 <span class="keyword">this</span>.WCH = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createWCH();
01028         } <span class="keywordflow">else</span> {
01029                 parent = _par;
01030                 <span class="keyword">this</span>.isPopup = <span class="keyword">false</span>;
01031         }
01032         <span class="keyword">this</span>.date = <span class="keyword">this</span>.dateStr ? <span class="keyword">new</span> Date(<span class="keyword">this</span>.dateStr) : <span class="keyword">new</span> Date();
01033 
01034         var table = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"table"</span>);
01035         <span class="keyword">this</span>.table = table;
01036         table.cellSpacing = 0;
01037         table.cellPadding = 0;
01038         table.calendar = <span class="keyword">this</span>;
01039         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(table, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseDown);
01040 
01041         var div = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01042         <span class="keyword">this</span>.element = div;
01043         div.className = <span class="stringliteral">"calendar"</span>;
01044         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01045                 div.style.position = <span class="stringliteral">"absolute"</span>;
01046                 div.style.display = <span class="stringliteral">"none"</span>;
01047         }
01048         div.appendChild(table);
01049 
01050         var thead = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"thead"</span>, table);
01051         var cell = null;
01052         var row = null;
01053 
01054         var cal = <span class="keyword">this</span>;
01055         var hh = function (text, cs, navtype) {
01056                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01057                 cell.colSpan = cs;
01058                 cell.className = <span class="stringliteral">"button"</span>;
01059                 <span class="keywordflow">if</span> (Math.abs(navtype) &lt;= 2)
01060                         cell.className += <span class="stringliteral">" nav"</span>;
01061                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01062                 cell.calendar = cal;
01063                 cell.navtype = navtype;
01064                 <span class="keywordflow">if</span> (text.substr(0, 1) != <span class="stringliteral">"&amp;"</span>) {
01065                         cell.appendChild(document.createTextNode(text));
01066                 }
01067                 <span class="keywordflow">else</span> {
01068                         <span class="comment">// FIXME: dirty hack for entities</span>
01069                         cell.innerHTML = text;
01070                 }
01071                 <span class="keywordflow">return</span> cell;
01072         };
01073 
01074         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01075         var title_length = 6;
01076         <span class="keyword">this</span>.isPopup &amp;&amp; --title_length;
01077         <span class="keyword">this</span>.weekNumbers &amp;&amp; ++title_length;
01078 
01079         hh(<span class="stringliteral">"?"</span>, 1, 400).ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"INFO"</span>);
01080         <span class="keyword">this</span>.title = hh(<span class="stringliteral">""</span>, title_length, 300);
01081         <span class="keyword">this</span>.title.className = <span class="stringliteral">"title"</span>;
01082         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01083                 <span class="keyword">this</span>.title.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01084                 <span class="keyword">this</span>.title.style.cursor = <span class="stringliteral">"move"</span>;
01085                 hh(<span class="stringliteral">"&amp;#x00d7;"</span>, 1, 200).ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"CLOSE"</span>);
01086         }
01087 
01088         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01089         row.className = <span class="stringliteral">"headrow"</span>;
01090 
01091         <span class="keyword">this</span>._nav_py = hh(<span class="stringliteral">"&amp;#x00ab;"</span>, 1, -2);
01092         <span class="keyword">this</span>._nav_py.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PREV_YEAR"</span>);
01093 
01094         <span class="keyword">this</span>._nav_pm = hh(<span class="stringliteral">"&amp;#x2039;"</span>, 1, -1);
01095         <span class="keyword">this</span>._nav_pm.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PREV_MONTH"</span>);
01096 
01097         <span class="keyword">this</span>._nav_now = hh(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TODAY"</span>), <span class="keyword">this</span>.weekNumbers ? 4 : 3, 0);
01098         <span class="keyword">this</span>._nav_now.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"GO_TODAY"</span>);
01099 
01100         <span class="keyword">this</span>._nav_nm = hh(<span class="stringliteral">"&amp;#x203a;"</span>, 1, 1);
01101         <span class="keyword">this</span>._nav_nm.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"NEXT_MONTH"</span>);
01102 
01103         <span class="keyword">this</span>._nav_ny = hh(<span class="stringliteral">"&amp;#x00bb;"</span>, 1, 2);
01104         <span class="keyword">this</span>._nav_ny.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"NEXT_YEAR"</span>);
01105 
01106         <span class="comment">// day names</span>
01107         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01108         row.className = <span class="stringliteral">"daynames"</span>;
01109         <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01110                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01111                 cell.className = <span class="stringliteral">"name wn"</span>;
01112                 cell.appendChild(window.document.createTextNode(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WK"</span>)));
01113                 var cal_wk = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WK"</span>)
01114                         <span class="keywordflow">if</span> (cal_wk == null) {
01115                                 <span class="comment">//if it's not defined in the language file, leave it blank</span>
01116                                 cal_wk = <span class="stringliteral">""</span>;
01117                         }
01118 
01119         }
01120         <span class="keywordflow">for</span> (var i = 7; i &gt; 0; --i) {
01121                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01122                 cell.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01123                 <span class="keywordflow">if</span> (!i) {
01124                         cell.navtype = 100;
01125                         cell.calendar = <span class="keyword">this</span>;
01126                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01127                 }
01128         }
01129         <span class="keyword">this</span>.firstdayname = row.childNodes[<span class="keyword">this</span>.weekNumbers?1:0];
01130         <span class="keyword">this</span>._displayWeekdays();
01131 
01132         var tbody = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01133         <span class="keyword">this</span>.tbody = tbody;
01134 
01135         <span class="keywordflow">for</span> (i = 6; i &gt; 0; --i) {
01136                 row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01137                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01138                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01139                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01140                 }
01141                 <span class="keywordflow">for</span> (var j = 7; j &gt; 0; --j) {
01142                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01143                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01144                         cell.calendar = <span class="keyword">this</span>;
01145                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01146                 }
01147         }
01148 
01149         var tfoot = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tfoot"</span>, table);
01150 
01151         <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime) {
01152                 row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01153                 row.className = <span class="stringliteral">"time"</span>;
01154 
01155                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01156                 cell.className = <span class="stringliteral">"timetext"</span>;
01157                 cell.colSpan = <span class="keyword">this</span>.weekNumbers ? 2 : 1;
01158                 cell.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TIME"</span>) || <span class="stringliteral">"&amp;nbsp;"</span>;
01159 
01160                 (function(){
01161                         function makeTimePart(className, init, range_start, range_end) {
01162                                 var table, tbody, tr, tr2, part;
01163                                 <span class="keywordflow">if</span> (range_end) {
01164                                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01165                                         cell.colSpan = 2;
01166                                         cell.className = <span class="stringliteral">"parent-"</span> + className;
01167                                         table = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"table"</span>, cell);
01168                                         table.cellSpacing = table.cellPadding = 0;
01169                                         <span class="keywordflow">if</span> (className == <span class="stringliteral">"hour"</span>)
01170                                                 table.align = <span class="stringliteral">"right"</span>;
01171                                         table.className = <span class="stringliteral">"calendar-time-scroller"</span>;
01172                                         tbody = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01173                                         tr    = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01174                                         tr2   = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01175                                 } <span class="keywordflow">else</span>
01176                                         tr = row;
01177                                 part = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01178                                 part.className = className;
01179                                 part.appendChild(window.document.createTextNode(init));
01180                                 part.calendar = cal;
01181                                 part.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TIME_PART"</span>);
01182                                 part.navtype = 50;
01183                                 part._range = [];
01184                                 <span class="keywordflow">if</span> (!range_end)
01185                                         part._range = range_start;
01186                                 <span class="keywordflow">else</span> {
01187                                         part.rowSpan = 2;
01188                                         <span class="keywordflow">for</span> (var i = range_start; i &lt;= range_end; ++i) {
01189                                                 var txt;
01190                                                 <span class="keywordflow">if</span> (i &lt; 10 &amp;&amp; range_end &gt;= 10) txt = <span class="charliteral">'0'</span> + i;
01191                                                 <span class="keywordflow">else</span> txt = '' + i;
01192                                                 part._range[part._range.length] = txt;
01193                                         }
01194                                         var up = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01195                                         up.className = <span class="stringliteral">"up"</span>;
01196                                         up.navtype = 201;
01197                                         up.calendar = cal;
01198                                         up.timePart = part;
01199                                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
01200                                                 up.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01201                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(up);
01202 
01203                                         var down = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr2);
01204                                         down.className = <span class="stringliteral">"down"</span>;
01205                                         down.navtype = 202;
01206                                         down.calendar = cal;
01207                                         down.timePart = part;
01208                                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
01209                                                 down.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01210                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(down);
01211                                 }
01212                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(part);
01213                                 <span class="keywordflow">return</span> part;
01214                         };
01215                         var hrs = cal.date.getHours();
01216                         var mins = cal.date.getMinutes();
01217                         var t12 = !cal.time24;
01218                         var pm = (hrs &gt; 12);
01219                         <span class="keywordflow">if</span> (t12 &amp;&amp; pm) hrs -= 12;
01220                         var H = makeTimePart(<span class="stringliteral">"hour"</span>, hrs, t12 ? 1 : 0, t12 ? 12 : 23);
01221                         H._step = 1;
01222                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01223                         cell.innerHTML = <span class="stringliteral">":"</span>;
01224                         cell.className = <span class="stringliteral">"colon"</span>;
01225                         var M = makeTimePart(<span class="stringliteral">"minute"</span>, mins, 0, 59);
01226                         M._step = 5; <span class="comment">// FIXME: make this part configurable</span>
01227                         var AP = null;
01228                         <span class="keywordflow">if</span> (t12) {
01229                                 AP = makeTimePart(<span class="stringliteral">"ampm"</span>, pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>, [<span class="stringliteral">"am"</span>, <span class="stringliteral">"pm"</span>]);
01230                                 AP.className += <span class="stringliteral">" button"</span>;
01231                         } <span class="keywordflow">else</span>
01232                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row).innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01233 
01234                         cal.onSetTime = function() {
01235                                 var hrs = <span class="keyword">this</span>.date.getHours();
01236                                 var mins = <span class="keyword">this</span>.date.getMinutes();
01237                                 var pm = (hrs &gt; 12);
01238                                 <span class="keywordflow">if</span> (pm &amp;&amp; t12) hrs -= 12;
01239                                 H.firstChild.data = (hrs &lt; 10) ? (<span class="stringliteral">"0"</span> + hrs) : hrs;
01240                                 M.firstChild.data = (mins &lt; 10) ? (<span class="stringliteral">"0"</span> + mins) : mins;
01241                                 <span class="keywordflow">if</span> (t12)
01242                                         AP.firstChild.data = pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>;
01243                         };
01244 
01245                         cal.onUpdateTime = function() {
01246                                 var date = <span class="keyword">this</span>.date;
01247                                 var h = parseInt(H.firstChild.data, 10);
01248                                 <span class="keywordflow">if</span> (t12) {
01249                                         <span class="keywordflow">if</span> (/pm/i.test(AP.firstChild.data) &amp;&amp; h &lt; 12)
01250                                                 h += 12;
01251                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (/am/i.test(AP.firstChild.data) &amp;&amp; h == 12)
01252                                                 h = 0;
01253                                 }
01254                                 var d = date.getDate();
01255                                 var m = date.getMonth();
01256                                 var y = date.getFullYear();
01257                                 date.setHours(h);
01258                                 date.setMinutes(parseInt(M.firstChild.data, 10));
01259                                 date.setFullYear(y);
01260                                 date.setMonth(m);
01261                                 date.setDate(d);
01262                                 <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
01263                                 <span class="keyword">this</span>.callHandler();
01264                         };
01265                 })();
01266         } <span class="keywordflow">else</span> {
01267                 <span class="keyword">this</span>.onSetTime = <span class="keyword">this</span>.onUpdateTime = function() {};
01268         }
01269 
01270         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01271         row.className = <span class="stringliteral">"footrow"</span>;
01272 
01273         cell = hh(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>), <span class="keyword">this</span>.weekNumbers ? 8 : 7, 300);
01274         cell.className = <span class="stringliteral">"ttip"</span>;
01275         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01276                 cell.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01277                 cell.style.cursor = <span class="stringliteral">"move"</span>;
01278         }
01279         <span class="keyword">this</span>.tooltips = cell;
01280 
01281         div = <span class="keyword">this</span>.monthsCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01282         div.className = <span class="stringliteral">"combo"</span>;
01283         <span class="keywordflow">for</span> (i = 0; i &lt; 12; ++i) {
01284                 var mn = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01285                 mn.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01286                 mn.month = i;
01287                 mn.appendChild(window.document.createTextNode(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(i, <span class="stringliteral">"smn"</span>)));
01288                 div.appendChild(mn);
01289         }
01290 
01291         div = <span class="keyword">this</span>.yearsCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01292         div.className = <span class="stringliteral">"combo"</span>;
01293         <span class="keywordflow">for</span> (i = 12; i &gt; 0; --i) {
01294                 var yr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01295                 yr.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01296                 yr.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01297                 div.appendChild(yr);
01298         }
01299 
01300         div = <span class="keyword">this</span>.histCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01301         div.className = <span class="stringliteral">"combo history"</span>;
01302 
01303         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
01304         parent.appendChild(<span class="keyword">this</span>.element);
01305 };
01306 
<a name="l01315"></a><a class="code" href="calendar_8js.html#a26">01315</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent = function(ev) {
01316         <span class="keywordflow">if</span> (!window.calendar) {
01317                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01318         }
01319         (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie) &amp;&amp; (ev = window.event);
01320         var cal = window.calendar;
01321         var act = (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie || ev.type == <span class="stringliteral">"keypress"</span>);
01322         var K = ev.keyCode;
01323         <span class="keywordflow">if</span> (ev.ctrlKey) {
01324                 <span class="keywordflow">switch</span> (K) {
01325                     <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01326                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_pm);
01327                         <span class="keywordflow">break</span>;
01328                     <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01329                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_py);
01330                         <span class="keywordflow">break</span>;
01331                     <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01332                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_nm);
01333                         <span class="keywordflow">break</span>;
01334                     <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01335                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_ny);
01336                         <span class="keywordflow">break</span>;
01337                     <span class="keywordflow">default</span>:
01338                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01339                 }
01340         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (K) {
01341             <span class="keywordflow">case</span> 32: <span class="comment">// KEY space (now)</span>
01342                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_now);
01343                 <span class="keywordflow">break</span>;
01344             <span class="keywordflow">case</span> 27: <span class="comment">// KEY esc</span>
01345                 act &amp;&amp; cal.callCloseHandler();
01346                 <span class="keywordflow">break</span>;
01347             <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01348             <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01349             <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01350             <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01351                 <span class="keywordflow">if</span> (act) {
01352                         var prev, pos, x, y, ne, el;
01353                         prev = (K == 37) || (K == 38);
01354                         function setVars() {
01355                                 el = cal.currentDateEl;
01356                                 pos = el.pos;
01357                                 y = pos[0];
01358                                 x = pos[1];
01359                                 ne = cal.ar_days[y][x];
01360                         };setVars();
01361                         function prevMonth() {
01362                                 <span class="comment">//Zapatec.Calendar.cellClick(cal._nav_pm);</span>
01363                                 var date = <span class="keyword">new</span> Date(cal.date.getFullYear(), cal.date.getMonth()-1, 1);
01364                                 date.setDate(date.getMonthDays());
01365                                 cal.setDate(date);
01366                         };
01367                         function nextMonth() {
01368                                 <span class="comment">//Zapatec.Calendar.cellClick(cal._nav_nm);</span>
01369                                 var date = <span class="keyword">new</span> Date(cal.date.getFullYear(), cal.date.getMonth()+1, 1);
01370                                 cal.setDate(date);
01371                         };
01372                         <span class="keywordflow">while</span> (1) {
01373                                 <span class="keywordflow">switch</span> (K) {
01374                                     <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01375                                         <span class="keywordflow">if</span> (--x &gt;= 0)
01376                                                 ne = cal.ar_days[y][x];
01377                                         <span class="keywordflow">else</span> {
01378                                                 x = 6;
01379                                                 K = 38;
01380                                                 <span class="keywordflow">continue</span>;
01381                                         }
01382                                         <span class="keywordflow">break</span>;
01383                                     <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01384                                         <span class="keywordflow">if</span> (--y &gt;= 0)
01385                                                 ne = cal.ar_days[y][x];
01386                                         <span class="keywordflow">else</span> {
01387                                                 prevMonth();
01388                                                 setVars();
01389                                         }
01390                                         <span class="keywordflow">break</span>;
01391                                     <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01392                                         <span class="keywordflow">if</span> (++x &lt; 7)
01393                                                 ne = cal.ar_days[y][x];
01394                                         <span class="keywordflow">else</span> {
01395                                                 x = 0;
01396                                                 K = 40;
01397                                                 <span class="keywordflow">continue</span>;
01398                                         }
01399                                         <span class="keywordflow">break</span>;
01400                                     <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01401                                         <span class="keywordflow">if</span> (++y &lt; cal.ar_days.length)
01402                                                 ne = cal.ar_days[y][x];
01403                                         <span class="keywordflow">else</span> {
01404                                                 nextMonth();
01405                                                 setVars();
01406                                         }
01407                                         <span class="keywordflow">break</span>;
01408                                 }
01409                                 <span class="keywordflow">break</span>;
01410                         }
01411                         <span class="keywordflow">if</span> (ne) {
01412                                 <span class="keywordflow">if</span> (!ne.otherMonth) {
01413                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"selected"</span>);
01414                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(ne, <span class="stringliteral">"selected"</span>);
01415                                         cal.date.setDateOnly(<span class="keyword">new</span> Date(ne.caldate[0], ne.caldate[1], ne.caldate[2]));
01416                                         cal.currentDateEl = ne;
01417                                 } <span class="keywordflow">else</span> {
01418                                         <span class="keywordflow">if</span> (!ne.disabled)
01419                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(ne);
01420                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prev)
01421                                                 prevMonth();
01422                                         <span class="keywordflow">else</span>
01423                                                 nextMonth();
01424                                 }
01425                         }
01426                         cal.callHandler();
01427                 }
01428                 <span class="keywordflow">break</span>;
01429             <span class="keywordflow">case</span> 13: <span class="comment">// KEY enter</span>
01430                 <span class="keywordflow">if</span> (act) {
01431                         cal.callHandler();
01432                         cal.hide();
01433                 }
01434                 <span class="keywordflow">break</span>;
01435             <span class="keywordflow">default</span>:
01436                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01437         }
01438         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
01439 };
01440 
<a name="l01466"></a><a class="code" href="calendar_8js.html#a27">01466</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._init = function (firstDayOfWeek, date) {
01467         var
01468                 today = <span class="keyword">new</span> Date(),
01469                 TD = today.getDate(),
01470                 TY = today.getFullYear(),
01471                 TM = today.getMonth();
01472         <span class="comment">//this.table.style.visibility = "hidden";</span>
01473         var year = date.getFullYear();
01474         var month = date.getMonth();
01475         <span class="keywordflow">if</span> (year &lt; <span class="keyword">this</span>.minYear)
01476                 date.setFullYear(year = <span class="keyword">this</span>.minYear);
01477         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year &gt; <span class="keyword">this</span>.maxYear)
01478                 date.setFullYear(year = <span class="keyword">this</span>.maxYear);
01479         <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.minYear &amp;&amp; month &lt; <span class="keyword">this</span>.minMonth)
01480                 date.setMonth(month = <span class="keyword">this</span>.minMonth);
01481         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.maxYear &amp;&amp; month &gt; <span class="keyword">this</span>.maxMonth)
01482                 date.setMonth(month = <span class="keyword">this</span>.maxMonth);
01483         <span class="keyword">this</span>.firstDayOfWeek = firstDayOfWeek;
01484         <span class="keyword">this</span>.date = date;
01485         (<span class="keyword">this</span>.date = <span class="keyword">new</span> Date(<span class="keyword">this</span>.date)).setDateOnly(date);
01486         var mday = date.getDate();
01487         var no_days = date.getMonthDays();
01488 
01489         <span class="comment">// calendar voodoo for computing the first day that would actually be</span>
01490         <span class="comment">// displayed in the calendar, even if it's from the previous month.</span>
01491         <span class="comment">// WARNING: this is magic. ;-)</span>
01492         date.setDate(1);
01493         var day1 = (date.getDay() - <span class="keyword">this</span>.firstDayOfWeek) % 7;
01494         <span class="keywordflow">if</span> (day1 &lt; 0)
01495                 day1 += 7;
01496         date.setDate(-day1);
01497         date.setDate(date.getDate() + 1);
01498 
01499         var row = <span class="keyword">this</span>.tbody.firstChild;
01500         var MN = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(month, <span class="stringliteral">"smn"</span>);
01501         var ar_days = <span class="keyword">this</span>.ar_days = [];
01502         var weekend = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
01503         var dates = <span class="keyword">this</span>.multiple ? (<span class="keyword">this</span>.datesCells = {}) : null;
01504         var DATETXT = <span class="keyword">this</span>.getDateText;
01505         <span class="keywordflow">for</span> (var i = 7; --i &gt; 0; row = row.nextSibling) {
01506                 var cell = row.firstChild;
01507                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01508                         cell.className = <span class="stringliteral">"day wn"</span>;
01509                         cell.innerHTML = date.getWeekNumber();
01510                         cell = cell.nextSibling;
01511                 }
01512                 var ar_days_y = ar_days[ar_days.length] = [];
01513                 row.className = <span class="stringliteral">"daysrow"</span>;
01514                 var hasdays = <span class="keyword">false</span>, iday;
01515                 <span class="keywordflow">for</span> (; cell &amp;&amp; (iday = date.getDate()); date.setDate(iday+1), cell = cell.nextSibling) {
01516                         cell.pos = [6-i, ar_days_y.length];
01517                         ar_days_y[ar_days_y.length] = cell;
01518                         var
01519                                 wday = date.getDay(),
01520                                 dmonth = date.getMonth(),
01521                                 dyear = date.getFullYear();
01522                         cell.className = <span class="stringliteral">"day"</span>;
01523                         var current_month = !(cell.otherMonth = !(dmonth == month));
01524                         <span class="keywordflow">if</span> (!current_month) {
01525                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsOtherMonths)
01526                                         cell.className += <span class="stringliteral">" othermonth"</span>;
01527                                 <span class="keywordflow">else</span> {
01528                                         cell.className = <span class="stringliteral">"emptycell"</span>;
01529                                         cell.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01530                                         cell.disabled = <span class="keyword">true</span>;
01531                                         <span class="keywordflow">continue</span>;
01532                                 }
01533                         } <span class="keywordflow">else</span>
01534                                 hasdays = <span class="keyword">true</span>;
01535                         cell.disabled = <span class="keyword">false</span>;
01536                         cell.innerHTML = DATETXT ? DATETXT(date, year, month, iday) : iday;
01537                         dates &amp;&amp; (dates[date.print(<span class="stringliteral">"%Y%m%d"</span>)] = cell);
01538                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus) {
01539                                 var status = <span class="keyword">this</span>.getDateStatus(date, year, month, iday);
01540                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateToolTip) {
01541                                         var toolTip = <span class="keyword">this</span>.getDateToolTip(date, year, month, iday);
01542                                         <span class="keywordflow">if</span> (toolTip)
01543                                                 cell.title = toolTip;
01544                                 }
01545                                 <span class="keywordflow">if</span> (status === <span class="keyword">true</span>) {
01546                                         cell.className += <span class="stringliteral">" disabled"</span>;
01547                                         cell.disabled = <span class="keyword">true</span>;
01548                                 } <span class="keywordflow">else</span> {
01549                                         <span class="keywordflow">if</span> (/disabled/i.test(status))
01550                                                 cell.disabled = <span class="keyword">true</span>;
01551                                         cell.className += <span class="stringliteral">" "</span> + status;
01552                                 }
01553                         }
01554                         <span class="keywordflow">if</span> (!cell.disabled) {
01555                                 cell.caldate = [dyear, dmonth, iday];
01556                                 cell.ttip = <span class="stringliteral">"_"</span>;
01557                                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.multiple &amp;&amp; current_month &amp;&amp; iday == mday &amp;&amp; <span class="keyword">this</span>.hiliteToday) {
01558                                         cell.className += <span class="stringliteral">" selected"</span>;
01559                                         <span class="keyword">this</span>.currentDateEl = cell;
01560                                 }
01561                                 <span class="keywordflow">if</span> (dyear == TY &amp;&amp; dmonth == TM &amp;&amp; iday == TD) {
01562                                         cell.className += <span class="stringliteral">" today"</span>;
01563                                         cell.ttip += <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PART_TODAY"</span>);
01564                                 }
01565                                 <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(wday.toString()) != -1)) {
01566                                         cell.className += cell.otherMonth ? <span class="stringliteral">" oweekend"</span> : <span class="stringliteral">" weekend"</span>;
01567                                 }
01568                         }
01569                 }
01570                 <span class="keywordflow">if</span> (!(hasdays || <span class="keyword">this</span>.showsOtherMonths))
01571                         row.className = <span class="stringliteral">"emptyrow"</span>;
01572         }
01573         <span class="comment">//this.title.firstChild.data = Zapatec.Calendar.i18n(month, "mn") + ", " + year;</span>
01574         <span class="keyword">this</span>.title.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(month, <span class="stringliteral">"mn"</span>) + <span class="stringliteral">", "</span> + year;
01575         <span class="keyword">this</span>.onSetTime();
01576         <span class="comment">//this.table.style.visibility = "visible";</span>
01577         <span class="keyword">this</span>._initMultipleDates();
01578         <span class="keyword">this</span>.updateWCH();
01579         <span class="comment">// PROFILE</span>
01580         <span class="comment">// this.showHint("Generated in " + ((new Date()) - today) + " ms");</span>
01581 };
01582 
<a name="l01588"></a><a class="code" href="calendar_8js.html#a28">01588</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._initMultipleDates = function() {
01589         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
01590                 <span class="keywordflow">for</span> (var i in <span class="keyword">this</span>.multiple) {
01591                         var cell = <span class="keyword">this</span>.datesCells[i];
01592                         var d = <span class="keyword">this</span>.multiple[i];
01593                         <span class="keywordflow">if</span> (!d)
01594                                 <span class="keywordflow">continue</span>;
01595                         <span class="keywordflow">if</span> (cell)
01596                                 cell.className += <span class="stringliteral">" selected"</span>;
01597                 }
01598         }
01599 };
01600 
<a name="l01610"></a><a class="code" href="calendar_8js.html#a29">01610</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._toggleMultipleDate = function(date) {
01611         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
01612                 var ds = date.print(<span class="stringliteral">"%Y%m%d"</span>);
01613                 var cell = <span class="keyword">this</span>.datesCells[ds];
01614                 <span class="keywordflow">if</span> (cell) {
01615                         var d = <span class="keyword">this</span>.multiple[ds];
01616                         <span class="keywordflow">if</span> (!d) {
01617                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cell, <span class="stringliteral">"selected"</span>);
01618                                 <span class="keyword">this</span>.multiple[ds] = date;
01619                         } <span class="keywordflow">else</span> {
01620                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"selected"</span>);
01621                                 <span class="keyword">delete</span> <span class="keyword">this</span>.multiple[ds];
01622                         }
01623                 }
01624         }
01625 };
01626 
<a name="l01648"></a><a class="code" href="calendar_8js.html#a30">01648</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateToolTipHandler = function (unaryFunction) {
01649         <span class="keyword">this</span>.getDateToolTip = unaryFunction;
01650 };
01651 
<a name="l01660"></a><a class="code" href="calendar_8js.html#a31">01660</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDate = function (date) {
01661         <span class="comment">// workaround for some bugs in our parseDate code</span>
01662         <span class="keywordflow">if</span> (!date)
01663                 date = <span class="keyword">new</span> Date();
01664         <span class="keywordflow">if</span> (!date.equalsTo(<span class="keyword">this</span>.date)) {
01665                 var year = date.getFullYear(), m = date.getMonth();
01666                 <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.minYear &amp;&amp; m &lt; <span class="keyword">this</span>.minMonth)
01667                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt;"</span> + <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">" »»»&lt;/div&gt;"</span>);
01668                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.maxYear &amp;&amp; m &gt; <span class="keyword">this</span>.maxMonth)
01669                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt;««« "</span> + <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">"&lt;/div&gt;"</span>);
01670                 <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, date);
01671         }
01672 };
01673 
<a name="l01679"></a><a class="code" href="calendar_8js.html#a32">01679</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showHint = function(text) {
01680         <span class="keyword">this</span>.tooltips.innerHTML = text;
01681 };
01682 
<a name="l01692"></a><a class="code" href="calendar_8js.html#a33">01692</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.reinit = function() {
01693         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
01694 };
01695 
<a name="l01702"></a><a class="code" href="calendar_8js.html#a34">01702</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.refresh = function() {
01703         var p = <span class="keyword">this</span>.isPopup ? null : <span class="keyword">this</span>.element.parentNode;
01704         var x = parseInt(<span class="keyword">this</span>.element.style.left);
01705         var y = parseInt(<span class="keyword">this</span>.element.style.top);
01706         <span class="keyword">this</span>.destroy();
01707         <span class="keyword">this</span>.dateStr = <span class="keyword">this</span>.date;
01708         <span class="keyword">this</span>.create(p);
01709         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup)
01710                 <span class="keyword">this</span>.showAt(x, y);
01711         <span class="keywordflow">else</span>
01712                 <span class="keyword">this</span>.show();
01713 };
01714 
<a name="l01720"></a><a class="code" href="calendar_8js.html#a35">01720</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setFirstDayOfWeek = function (firstDayOfWeek) {
01721         <span class="keywordflow">if</span> (<span class="keyword">this</span>.firstDayOfWeek != firstDayOfWeek) {
01722                 <span class="keyword">this</span>._init(firstDayOfWeek, <span class="keyword">this</span>.date);
01723                 <span class="keyword">this</span>._displayWeekdays();
01724         }
01725 };
01726 
<a name="l01800"></a><a class="code" href="calendar_8js.html#a36">01800</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateStatusHandler = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDisabledHandler = function (unaryFunction) {
01801         <span class="keyword">this</span>.getDateStatus = unaryFunction;
01802 };
01803 
<a name="l01830"></a><a class="code" href="calendar_8js.html#a37">01830</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setRange = function (A, Z) {
01831         var m,
01832                 a = Math.min(A, Z),
01833                 z = Math.max(A, Z);
01834         <span class="keyword">this</span>.minYear = m = Math.floor(a);
01835         <span class="keyword">this</span>.minMonth = (m == a) ? 0 : Math.ceil((a-m)*100-1);
01836         <span class="keyword">this</span>.maxYear = m = Math.floor(z);
01837         <span class="keyword">this</span>.maxMonth = (m == z) ? 11 : Math.ceil((z-m)*100-1);
01838 };
01839 
<a name="l01845"></a><a class="code" href="calendar_8js.html#a38">01845</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.callHandler = function () {
01846         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onSelected) {
01847                 <span class="keyword">this</span>.onSelected(<span class="keyword">this</span>, <span class="keyword">this</span>.date.print(<span class="keyword">this</span>.dateFormat));
01848         }
01849 };
01850 
<a name="l01858"></a><a class="code" href="calendar_8js.html#a39">01858</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.updateHistory = function () {
01859         var a, i, d, tmp, s, str = <span class="stringliteral">""</span>, len = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.hsize - 1;
01860         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
01861                 a = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history.split(/,/);
01862                 i = 0;
01863                 <span class="keywordflow">while</span> (i &lt; len &amp;&amp; (tmp = a[i++])) {
01864                         s = tmp.split(/\<span class="comment">//);</span>
01865                         d = <span class="keyword">new</span> Date(parseInt(s[0], 10), parseInt(s[1], 10)-1, parseInt(s[2], 10),
01866                                      parseInt(s[3], 10), parseInt(s[4], 10));
01867                         <span class="keywordflow">if</span> (!d.dateEqualsTo(<span class="keyword">this</span>.date))
01868                                 str += <span class="stringliteral">","</span> + tmp;
01869                 }
01870         }
01871         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history = <span class="keyword">this</span>.date.print(<span class="stringliteral">"%Y/%m/%d/%H/%M"</span>) + str;
01872         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs();
01873 };
01874 
<a name="l01879"></a><a class="code" href="calendar_8js.html#a40">01879</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.callCloseHandler = function () {
01880         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dateClicked) {
01881                 <span class="keyword">this</span>.updateHistory();
01882         }
01883         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onClose) {
01884                 <span class="keyword">this</span>.onClose(<span class="keyword">this</span>);
01885         }
01886         <span class="keyword">this</span>.hideShowCovered();
01887 };
01888 
<a name="l01890"></a><a class="code" href="calendar_8js.html#a41">01890</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.destroy = function () {
01891         <span class="keyword">this</span>.hide();            <span class="comment">// this also removes keyboard events :-\</span>
01892         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.destroy(<span class="keyword">this</span>.element);
01893         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.destroy(<span class="keyword">this</span>.WCH);
01894         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
01895         window.calendar = null;
01896 };
01897 
<a name="l01904"></a><a class="code" href="calendar_8js.html#a42">01904</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.reparent = function (new_parent) {
01905         var el = <span class="keyword">this</span>.element;
01906         el.parentNode.removeChild(el);
01907         new_parent.appendChild(el);
01908 };
01909 
<a name="l01918"></a><a class="code" href="calendar_8js.html#a43">01918</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar = function(ev) {
01919         <span class="keywordflow">if</span> (!window.calendar) {
01920                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01921         }
01922         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev) : <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
01923         <span class="keywordflow">for</span> (; el != null &amp;&amp; el != <a class="code" href="calendar_8js.html#a71">calendar</a>.element; el = el.parentNode);
01924         <span class="keywordflow">if</span> (el == null) {
01925                 <span class="comment">// calls closeHandler which should hide the calendar.</span>
01926                 window.calendar.callCloseHandler();
01927                 <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
01928         }
01929 };
01930 
<a name="l01940"></a><a class="code" href="calendar_8js.html#a44">01940</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.updateWCH = function(other_el) {
01941         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.setupWCH_el(<span class="keyword">this</span>.WCH, <span class="keyword">this</span>.element, other_el);
01942 };
01943 
<a name="l01955"></a><a class="code" href="calendar_8js.html#a45">01955</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.show = function () {
01956         var rows = <span class="keyword">this</span>.table.getElementsByTagName(<span class="stringliteral">"tr"</span>);
01957         <span class="keywordflow">for</span> (var i = rows.length; i &gt; 0;) {
01958                 var row = rows[--i];
01959                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(row, <span class="stringliteral">"rowhilite"</span>);
01960                 var cells = row.getElementsByTagName(<span class="stringliteral">"td"</span>);
01961                 <span class="keywordflow">for</span> (var j = cells.length; j &gt; 0;) {
01962                         var cell = cells[--j];
01963                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"hilite"</span>);
01964                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"active"</span>);
01965                 }
01966         }
01967         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
01968         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
01969         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01970                 <span class="keyword">this</span>.updateWCH();
01971                 window.calendar = <span class="keyword">this</span>;
01972                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.noGrab) {
01973                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"keydown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
01974                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"keypress"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
01975                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar);
01976                 }
01977         }
01978         <span class="keyword">this</span>.hideShowCovered();
01979 };
01980 
<a name="l01986"></a><a class="code" href="calendar_8js.html#a46">01986</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.hide = function () {
01987         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01988                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"keydown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
01989                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"keypress"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
01990                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar);
01991         }
01992         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"none"</span>;
01993         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.hideWCH(<span class="keyword">this</span>.WCH);
01994         <span class="keyword">this</span>.hidden = <span class="keyword">true</span>;
01995         <span class="keyword">this</span>.hideShowCovered();
01996 };
01997 
<a name="l02006"></a><a class="code" href="calendar_8js.html#a47">02006</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showAt = function (x, y) {
02007         var s = <span class="keyword">this</span>.element.style;
02008         s.left = x + <span class="stringliteral">"px"</span>;
02009         s.top = y + <span class="stringliteral">"px"</span>;
02010         <span class="keyword">this</span>.show();
02011 };
02012 
<a name="l02041"></a><a class="code" href="calendar_8js.html#a48">02041</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showAtElement = function (el, opts) {
02042         var self = <span class="keyword">this</span>;
02043         var p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
02044         <span class="keywordflow">if</span> (!opts || typeof opts != <span class="stringliteral">"string"</span>) {
02045                 <span class="keyword">this</span>.showAt(p.x, p.y + el.offsetHeight);
02046                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02047         }
02048         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
02049         var w = self.element.offsetWidth;
02050         var h = self.element.offsetHeight;
02051         self.element.style.display = <span class="stringliteral">"none"</span>;
02052         var valign = opts.substr(0, 1);
02053         var halign = <span class="stringliteral">"l"</span>;
02054         <span class="keywordflow">if</span> (opts.length &gt; 1) {
02055                 halign = opts.substr(1, 1);
02056         }
02057         <span class="comment">// vertical alignment</span>
02058         <span class="keywordflow">switch</span> (valign) {
02059             <span class="keywordflow">case</span> <span class="stringliteral">"T"</span>: p.y -= h; <span class="keywordflow">break</span>;
02060             <span class="keywordflow">case</span> <span class="stringliteral">"B"</span>: p.y += el.offsetHeight; <span class="keywordflow">break</span>;
02061             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.y += (el.offsetHeight - h) / 2; <span class="keywordflow">break</span>;
02062             <span class="keywordflow">case</span> <span class="stringliteral">"t"</span>: p.y += el.offsetHeight - h; <span class="keywordflow">break</span>;
02063             <span class="keywordflow">case</span> <span class="stringliteral">"b"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02064         }
02065         <span class="comment">// horizontal alignment</span>
02066         <span class="keywordflow">switch</span> (halign) {
02067             <span class="keywordflow">case</span> <span class="stringliteral">"L"</span>: p.x -= w; <span class="keywordflow">break</span>;
02068             <span class="keywordflow">case</span> <span class="stringliteral">"R"</span>: p.x += el.offsetWidth; <span class="keywordflow">break</span>;
02069             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.x += (el.offsetWidth - w) / 2; <span class="keywordflow">break</span>;
02070             <span class="keywordflow">case</span> <span class="stringliteral">"l"</span>: p.x += el.offsetWidth - w; <span class="keywordflow">break</span>;
02071             <span class="keywordflow">case</span> <span class="stringliteral">"r"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02072         }
02073         p.width = w;
02074         p.height = h + 40;
02075         self.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02076         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.fixBoxPosition(p);
02077         self.showAt(p.x, p.y);
02078 };
02079 
<a name="l02086"></a><a class="code" href="calendar_8js.html#a49">02086</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateFormat = function (str) {
02087         <span class="keyword">this</span>.dateFormat = str;
02088 };
02089 
<a name="l02096"></a><a class="code" href="calendar_8js.html#a50">02096</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setTtDateFormat = function (str) {
02097         <span class="keyword">this</span>.ttDateFormat = str;
02098 };
02099 
02107 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.parseDate = function (str, fmt) {
02108         <span class="comment">// Konqueror</span>
02109         <span class="keywordflow">if</span> (!str)
02110                 <span class="keywordflow">return</span> <span class="keyword">this</span>.setDate(<span class="keyword">this</span>.date);
02111         <span class="keywordflow">if</span> (!fmt)
02112                 fmt = <span class="keyword">this</span>.dateFormat;
02113         var date = Date.parseDate(str, fmt);
02114         <span class="keywordflow">return</span> <span class="keyword">this</span>.setDate(date);
02115 };
02116 
<a name="l02135"></a><a class="code" href="calendar_8js.html#a52">02135</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.hideShowCovered = function () {
02136         <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5)
02137                 <span class="keywordflow">return</span>;
02138         var self = <span class="keyword">this</span>;
02139         function getVisib(obj){
02140                 var value = obj.style.visibility;
02141                 <span class="keywordflow">if</span> (!value) {
02142                         <span class="keywordflow">if</span> (window.document.defaultView &amp;&amp; typeof (window.document.defaultView.getComputedStyle) == <span class="stringliteral">"function"</span>) { <span class="comment">// Gecko, W3C</span>
02143                                 <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
02144                                         value = window.document.defaultView.
02145                                                 getComputedStyle(obj, <span class="stringliteral">""</span>).getPropertyValue(<span class="stringliteral">"visibility"</span>);
02146                                 <span class="keywordflow">else</span>
02147                                         value = '';
02148                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj.currentStyle) { <span class="comment">// IE</span>
02149                                 value = obj.currentStyle.visibility;
02150                         } <span class="keywordflow">else</span>
02151                                 value = '';
02152                 }
02153                 <span class="keywordflow">return</span> value;
02154         };
02155 
02156         var tags = [<span class="stringliteral">"applet"</span>, <span class="stringliteral">"iframe"</span>, <span class="stringliteral">"select"</span>];
02157         var el = self.element;
02158 
02159         var p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
02160         var EX1 = p.x;
02161         var EX2 = el.offsetWidth + EX1;
02162         var EY1 = p.y;
02163         var EY2 = el.offsetHeight + EY1;
02164 
02165         <span class="keywordflow">for</span> (var k = tags.length; k &gt; 0; ) {
02166                 var ar = window.document.getElementsByTagName(tags[--k]);
02167                 var cc = null;
02168 
02169                 <span class="keywordflow">for</span> (var i = ar.length; i &gt; 0;) {
02170                         cc = ar[--i];
02171 
02172                         p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(cc);
02173                         var CX1 = p.x;
02174                         var CX2 = cc.offsetWidth + CX1;
02175                         var CY1 = p.y;
02176                         var CY2 = cc.offsetHeight + CY1;
02177 
02178                         <span class="keywordflow">if</span> (self.hidden || (CX1 &gt; EX2) || (CX2 &lt; EX1) || (CY1 &gt; EY2) || (CY2 &lt; EY1)) {
02179                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02180                                         cc.__msh_save_visibility = getVisib(cc);
02181                                 }
02182                                 cc.style.visibility = cc.__msh_save_visibility;
02183                         } <span class="keywordflow">else</span> {
02184                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02185                                         cc.__msh_save_visibility = getVisib(cc);
02186                                 }
02187                                 cc.style.visibility = <span class="stringliteral">"hidden"</span>;
02188                         }
02189                 }
02190         }
02191 };
02192 
<a name="l02197"></a><a class="code" href="calendar_8js.html#a53">02197</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._displayWeekdays = function () {
02198         var fdow = <span class="keyword">this</span>.firstDayOfWeek;
02199         var cell = <span class="keyword">this</span>.firstdayname;
02200         var weekend = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
02201         <span class="keywordflow">for</span> (var i = 0; i &lt; 7; ++i) {
02202                 cell.className = <span class="stringliteral">"day name"</span>;
02203                 var realday = (i + fdow) % 7;
02204                 <span class="keywordflow">if</span> (i) {
02205                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>) != null) {
02206                                 cell.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>).replace(<span class="stringliteral">"%s"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(realday, <span class="stringliteral">"dn"</span>));
02207                         }
02208                         cell.navtype = 100;
02209                         cell.calendar = <span class="keyword">this</span>;
02210                         cell.fdow = realday;
02211                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
02212                 }
02213                 <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(realday.toString()) != -1)) {
02214                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cell, <span class="stringliteral">"weekend"</span>);
02215                 }
02216                 cell.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n((i + fdow) % 7, <span class="stringliteral">"sdn"</span>);
02217                 cell = cell.nextSibling;
02218         }
02219 };
02220 
<a name="l02222"></a><a class="code" href="calendar_8js.html#a54">02222</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._hideCombos = function () {
02223         <span class="keyword">this</span>.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02224         <span class="keyword">this</span>.yearsCombo.style.display = <span class="stringliteral">"none"</span>;
02225         <span class="keyword">this</span>.histCombo.style.display = <span class="stringliteral">"none"</span>;
02226         <span class="keyword">this</span>.updateWCH();
02227 };
02228 
<a name="l02230"></a><a class="code" href="calendar_8js.html#a55">02230</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._dragStart = function (ev) {
02231         ev || (ev = window.event);
02232         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dragging) {
02233                 <span class="keywordflow">return</span>;
02234         }
02235         <span class="keyword">this</span>.dragging = <span class="keyword">true</span>;
02236         var posX = ev.clientX + window.document.body.scrollLeft;
02237         var posY = ev.clientY + window.document.body.scrollTop;
02238         var st = <span class="keyword">this</span>.element.style;
02239         <span class="keyword">this</span>.xOffs = posX - parseInt(st.left);
02240         <span class="keyword">this</span>.yOffs = posY - parseInt(st.top);
02241         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
02242         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
02243         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd);
02244 };
02245 
02246 <span class="comment">// BEGIN: DATE OBJECT PATCHES</span>
02247 
02252 
<a name="l02253"></a><a class="code" href="group__DateExtras.html#ga0">02253</a> Date._MD = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]; 
<a name="l02255"></a><a class="code" href="group__DateExtras.html#ga1">02255</a> Date.SECOND = 1000;             
<a name="l02256"></a><a class="code" href="group__DateExtras.html#ga2">02256</a> Date.MINUTE = 60 * Date.SECOND; 
<a name="l02257"></a><a class="code" href="group__DateExtras.html#ga3">02257</a> Date.HOUR   = 60 * Date.MINUTE; 
<a name="l02258"></a><a class="code" href="group__DateExtras.html#ga4">02258</a> Date.DAY    = 24 * Date.HOUR;   
<a name="l02259"></a><a class="code" href="group__DateExtras.html#ga5">02259</a> Date.WEEK   =  7 * Date.DAY;    
<a name="l02267"></a><a class="code" href="group__DateExtras.html#ga6">02267</a> Date.prototype.getMonthDays = function(month) {
02268         var year = <span class="keyword">this</span>.getFullYear();
02269         <span class="keywordflow">if</span> (typeof month == <span class="stringliteral">"undefined"</span>) {
02270                 month = <span class="keyword">this</span>.getMonth();
02271         }
02272         <span class="keywordflow">if</span> (((0 == (year%4)) &amp;&amp; ( (0 != (year%100)) || (0 == (year%400)))) &amp;&amp; month == 1) {
02273                 <span class="keywordflow">return</span> 29;
02274         } <span class="keywordflow">else</span> {
02275                 <span class="keywordflow">return</span> Date._MD[month];
02276         }
02277 };
02278 
<a name="l02280"></a><a class="code" href="group__DateExtras.html#ga7">02280</a> Date.prototype.getDayOfYear = function() {
02281         var now = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), <span class="keyword">this</span>.getMonth(), <span class="keyword">this</span>.getDate(), 0, 0, 0);
02282         var then = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), 0, 0, 0, 0, 0);
02283         var time = now - then;
02284         <span class="keywordflow">return</span> Math.floor(time / Date.DAY);
02285 };
02286 
<a name="l02288"></a><a class="code" href="group__DateExtras.html#ga8">02288</a> Date.prototype.getWeekNumber = function() {
02289         var d = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), <span class="keyword">this</span>.getMonth(), <span class="keyword">this</span>.getDate(), 0, 0, 0);
02290         var DoW = d.getDay();
02291         d.setDate(d.getDate() - (DoW + 6) % 7 + 3); <span class="comment">// Nearest Thu</span>
02292         var ms = d.valueOf(); <span class="comment">// GMT</span>
02293         d.setMonth(0);
02294         d.setDate(4); <span class="comment">// Thu in Week 1</span>
02295         <span class="keywordflow">return</span> Math.round((ms - d.valueOf()) / (7 * 864e5)) + 1;
02296 };
02297 
<a name="l02299"></a><a class="code" href="group__DateExtras.html#ga9">02299</a> Date.prototype.equalsTo = function(date) {
02300         <span class="keywordflow">return</span> ((<span class="keyword">this</span>.getFullYear() == date.getFullYear()) &amp;&amp;
02301                 (<span class="keyword">this</span>.getMonth() == date.getMonth()) &amp;&amp;
02302                 (<span class="keyword">this</span>.getDate() == date.getDate()) &amp;&amp;
02303                 (<span class="keyword">this</span>.getHours() == date.getHours()) &amp;&amp;
02304                 (<span class="keyword">this</span>.getMinutes() == date.getMinutes()));
02305 };
02306 
<a name="l02308"></a><a class="code" href="group__DateExtras.html#ga10">02308</a> Date.prototype.dateEqualsTo = function(date) {
02309         <span class="keywordflow">return</span> ((<span class="keyword">this</span>.getFullYear() == date.getFullYear()) &amp;&amp;
02310                 (<span class="keyword">this</span>.getMonth() == date.getMonth()) &amp;&amp;
02311                 (<span class="keyword">this</span>.getDate() == date.getDate()));
02312 };
02313 
<a name="l02315"></a><a class="code" href="group__DateExtras.html#ga11">02315</a> Date.prototype.setDateOnly = function(date) {
02316         var tmp = <span class="keyword">new</span> Date(date);
02317         <span class="keyword">this</span>.setDate(1);
02318         <span class="keyword">this</span>.setFullYear(tmp.getFullYear());
02319         <span class="keyword">this</span>.setMonth(tmp.getMonth());
02320         <span class="keyword">this</span>.setDate(tmp.getDate());
02321 };
02322 
<a name="l02358"></a><a class="code" href="group__DateExtras.html#ga12">02358</a> Date.prototype.print = function (str) {
02359         var m = <span class="keyword">this</span>.getMonth();
02360         var d = <span class="keyword">this</span>.getDate();
02361         var y = <span class="keyword">this</span>.getFullYear();
02362         var wn = <span class="keyword">this</span>.getWeekNumber();
02363         var w = <span class="keyword">this</span>.getDay();
02364         var s = {};
02365         var hr = <span class="keyword">this</span>.getHours();
02366         var pm = (hr &gt;= 12);
02367         var ir = (pm) ? (hr - 12) : hr;
02368         var dy = <span class="keyword">this</span>.getDayOfYear();
02369         <span class="keywordflow">if</span> (ir == 0)
02370                 ir = 12;
02371         var min = <span class="keyword">this</span>.getMinutes();
02372         var sec = <span class="keyword">this</span>.getSeconds();
02373         s[<span class="stringliteral">"%a"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(w, <span class="stringliteral">"sdn"</span>); <span class="comment">// abbreviated weekday name [FIXME: I18N]</span>
02374         s[<span class="stringliteral">"%A"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(w, <span class="stringliteral">"dn"</span>); <span class="comment">// full weekday name</span>
02375         s[<span class="stringliteral">"%b"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(m, <span class="stringliteral">"smn"</span>); <span class="comment">// abbreviated month name [FIXME: I18N]</span>
02376         s[<span class="stringliteral">"%B"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(m, <span class="stringliteral">"mn"</span>); <span class="comment">// full month name</span>
02377         <span class="comment">// FIXME: %c : preferred date and time representation for the current locale</span>
02378         s[<span class="stringliteral">"%C"</span>] = 1 + Math.floor(y / 100); <span class="comment">// the century number</span>
02379         s[<span class="stringliteral">"%d"</span>] = (d &lt; 10) ? (<span class="stringliteral">"0"</span> + d) : d; <span class="comment">// the day of the month (range 01 to 31)</span>
02380         s[<span class="stringliteral">"%e"</span>] = d; <span class="comment">// the day of the month (range 1 to 31)</span>
02381         <span class="comment">// FIXME: %D : american date style: %m/%d/%y</span>
02382         <span class="comment">// FIXME: %E, %F, %G, %g, %h (man strftime)</span>
02383         s[<span class="stringliteral">"%H"</span>] = (hr &lt; 10) ? (<span class="stringliteral">"0"</span> + hr) : hr; <span class="comment">// hour, range 00 to 23 (24h format)</span>
02384         s[<span class="stringliteral">"%I"</span>] = (ir &lt; 10) ? (<span class="stringliteral">"0"</span> + ir) : ir; <span class="comment">// hour, range 01 to 12 (12h format)</span>
02385         s[<span class="stringliteral">"%j"</span>] = (dy &lt; 100) ? ((dy &lt; 10) ? (<span class="stringliteral">"00"</span> + dy) : (<span class="stringliteral">"0"</span> + dy)) : dy; <span class="comment">// day of the year (range 001 to 366)</span>
02386         s[<span class="stringliteral">"%k"</span>] = hr;           <span class="comment">// hour, range 0 to 23 (24h format)</span>
02387         s[<span class="stringliteral">"%l"</span>] = ir;           <span class="comment">// hour, range 1 to 12 (12h format)</span>
02388         s[<span class="stringliteral">"%m"</span>] = (m &lt; 9) ? (<span class="stringliteral">"0"</span> + (1+m)) : (1+m); <span class="comment">// month, range 01 to 12</span>
02389         s[<span class="stringliteral">"%M"</span>] = (min &lt; 10) ? (<span class="stringliteral">"0"</span> + min) : min; <span class="comment">// minute, range 00 to 59</span>
02390         s[<span class="stringliteral">"%n"</span>] = <span class="stringliteral">"\n"</span>;         <span class="comment">// a newline character</span>
02391         s[<span class="stringliteral">"%p"</span>] = pm ? <span class="stringliteral">"PM"</span> : <span class="stringliteral">"AM"</span>;
02392         s[<span class="stringliteral">"%P"</span>] = pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>;
02393         <span class="comment">// FIXME: %r : the time in am/pm notation %I:%M:%S %p</span>
02394         <span class="comment">// FIXME: %R : the time in 24-hour notation %H:%M</span>
02395         s[<span class="stringliteral">"%s"</span>] = Math.floor(<span class="keyword">this</span>.getTime() / 1000);
02396         s[<span class="stringliteral">"%S"</span>] = (sec &lt; 10) ? (<span class="stringliteral">"0"</span> + sec) : sec; <span class="comment">// seconds, range 00 to 59</span>
02397         s[<span class="stringliteral">"%t"</span>] = <span class="stringliteral">"\t"</span>;         <span class="comment">// a tab character</span>
02398         <span class="comment">// FIXME: %T : the time in 24-hour notation (%H:%M:%S)</span>
02399         s[<span class="stringliteral">"%U"</span>] = s[<span class="stringliteral">"%W"</span>] = s[<span class="stringliteral">"%V"</span>] = (wn &lt; 10) ? (<span class="stringliteral">"0"</span> + wn) : wn;
02400         s[<span class="stringliteral">"%u"</span>] = w + 1;        <span class="comment">// the day of the week (range 1 to 7, 1 = MON)</span>
02401         s[<span class="stringliteral">"%w"</span>] = w;            <span class="comment">// the day of the week (range 0 to 6, 0 = SUN)</span>
02402         <span class="comment">// FIXME: %x : preferred date representation for the current locale without the time</span>
02403         <span class="comment">// FIXME: %X : preferred time representation for the current locale without the date</span>
02404         s[<span class="stringliteral">"%y"</span>] = ('' + y).substr(2, 2); <span class="comment">// year without the century (range 00 to 99)</span>
02405         s[<span class="stringliteral">"%Y"</span>] = y;            <span class="comment">// year with the century</span>
02406         s[<span class="stringliteral">"%%"</span>] = <span class="stringliteral">"%"</span>;          <span class="comment">// a literal '%' character</span>
02407 
02408         var re = /%./g;
02409         <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5 &amp;&amp; !<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml &amp;&amp; !<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_mac_ie)
02410                 <span class="keywordflow">return</span> str.replace(re, function (par) { <span class="keywordflow">return</span> s[par] || par; });
02411 
02412         var a = str.match(re);
02413         <span class="keywordflow">for</span> (var i = 0; i &lt; a.length; i++) {
02414                 var tmp = s[a[i]];
02415                 <span class="keywordflow">if</span> (tmp) {
02416                         re = <span class="keyword">new</span> RegExp(a[i], <span class="charliteral">'g'</span>);
02417                         str = str.replace(re, tmp);
02418                 }
02419         }
02420 
02421         <span class="keywordflow">return</span> str;
02422 };
02423 
<a name="l02433"></a><a class="code" href="group__DateExtras.html#ga13">02433</a> Date.parseDate = function (str, fmt) {
02434         <span class="comment">// Konqueror</span>
02435         <span class="keywordflow">if</span> (!str)
02436                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date();
02437         var y = 0;
02438         var m = -1;
02439         var d = 0;
02440         var a = str.split(/\W+/);
02441         var b = fmt.match(/%./g);
02442         var i = 0, j = 0;
02443         var hr = 0;
02444         var min = 0;
02445         <span class="keywordflow">for</span> (i = 0; i &lt; a.length; ++i) {
02446                 <span class="keywordflow">if</span> (!a[i])
02447                         <span class="keywordflow">continue</span>;
02448                 <span class="keywordflow">switch</span> (b[i]) {
02449                     <span class="keywordflow">case</span> <span class="stringliteral">"%d"</span>:
02450                     <span class="keywordflow">case</span> <span class="stringliteral">"%e"</span>:
02451                         d = parseInt(a[i], 10);
02452                         <span class="keywordflow">break</span>;
02453 
02454                     <span class="keywordflow">case</span> <span class="stringliteral">"%m"</span>:
02455                         m = parseInt(a[i], 10) - 1;
02456                         <span class="keywordflow">break</span>;
02457 
02458                     <span class="keywordflow">case</span> <span class="stringliteral">"%Y"</span>:
02459                     <span class="keywordflow">case</span> <span class="stringliteral">"%y"</span>:
02460                         y = parseInt(a[i], 10);
02461                         (y &lt; 100) &amp;&amp; (y += (y &gt; 29) ? 1900 : 2000);
02462                         <span class="keywordflow">break</span>;
02463 
02464                     <span class="keywordflow">case</span> <span class="stringliteral">"%b"</span>:
02465                     <span class="keywordflow">case</span> <span class="stringliteral">"%B"</span>:
02466                         <span class="keywordflow">for</span> (j = 0; j &lt; 12; ++j)
02467                                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(j, <span class="stringliteral">"mn"</span>).substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) {
02468                                         m = j;
02469                                         <span class="keywordflow">break</span>;
02470                                 }
02471                         <span class="keywordflow">break</span>;
02472 
02473                     <span class="keywordflow">case</span> <span class="stringliteral">"%H"</span>:
02474                     <span class="keywordflow">case</span> <span class="stringliteral">"%I"</span>:
02475                     <span class="keywordflow">case</span> <span class="stringliteral">"%k"</span>:
02476                     <span class="keywordflow">case</span> <span class="stringliteral">"%l"</span>:
02477                         hr = parseInt(a[i], 10);
02478                         <span class="keywordflow">break</span>;
02479 
02480                     <span class="keywordflow">case</span> <span class="stringliteral">"%P"</span>:
02481                     <span class="keywordflow">case</span> <span class="stringliteral">"%p"</span>:
02482                         <span class="keywordflow">if</span> (/pm/i.test(a[i]) &amp;&amp; hr &lt; 12)
02483                                 hr += 12;
02484                         <span class="keywordflow">break</span>;
02485 
02486                     <span class="keywordflow">case</span> <span class="stringliteral">"%M"</span>:
02487                         min = parseInt(a[i], 10);
02488                         <span class="keywordflow">break</span>;
02489                 }
02490         }
02491         <span class="keywordflow">if</span> (y != 0 &amp;&amp; m != -1 &amp;&amp; d != 0)
02492                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date(y, m, d, hr, min, 0);
02493         y = 0; m = -1; d = 0;
02494         <span class="keywordflow">for</span> (i = 0; i &lt; a.length; ++i) {
02495                 <span class="keywordflow">if</span> (a[i].search(/[a-zA-Z]+/) != -1) {
02496                         var t = -1;
02497                         <span class="keywordflow">for</span> (j = 0; j &lt; 12; ++j)
02498                                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(j, <span class="stringliteral">"mn"</span>).substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) {
02499                                         t = j;
02500                                         <span class="keywordflow">break</span>;
02501                                 }
02502                         <span class="keywordflow">if</span> (t != -1) {
02503                                 <span class="keywordflow">if</span> (m != -1)
02504                                         d = m+1;
02505                                 m = t;
02506                         }
02507                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parseInt(a[i], 10) &lt;= 12 &amp;&amp; m == -1) {
02508                         m = a[i]-1;
02509                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parseInt(a[i], 10) &gt; 31 &amp;&amp; y == 0) {
02510                         y = parseInt(a[i], 10);
02511                         (y &lt; 100) &amp;&amp; (y += (y &gt; 29) ? 1900 : 2000);
02512                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 0) {
02513                         d = a[i];
02514                 }
02515         }
02516         <span class="keywordflow">if</span> (y == 0) {
02517                 var today = <span class="keyword">new</span> Date();
02518                 y = today.getFullYear();
02519         }
02520         <span class="keywordflow">if</span> (m != -1 &amp;&amp; d != 0)
02521                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date(y, m, d, hr, min, 0);
02522         <span class="keywordflow">return</span> null;
02523 };
02524 
<a name="l02525"></a><a class="code" href="group__DateExtras.html#ga14">02525</a> Date.prototype.__msh_oldSetFullYear = Date.prototype.setFullYear; 
<a name="l02535"></a><a class="code" href="group__DateExtras.html#ga15">02535</a> Date.prototype.setFullYear = function(y) {
02536         var d = <span class="keyword">new</span> Date(<span class="keyword">this</span>);
02537         d.__msh_oldSetFullYear(y);
02538         <span class="keywordflow">if</span> (d.getMonth() != <span class="keyword">this</span>.getMonth())
02539                 <span class="keyword">this</span>.setDate(28);
02540         <span class="keyword">this</span>.__msh_oldSetFullYear(y);
02541 };
02542 
02544 
02545 <span class="comment">// END: DATE OBJECT PATCHES</span>
02546 
<a name="l02547"></a><a class="code" href="calendar_8js.html#a71">02547</a> window.calendar = null;         
02549 <span class="comment">// initialize the preferences object;</span>
02550 <span class="comment">// embed it in a try/catch so we don't have any surprises</span>
02551 <span class="keywordflow">try</span> {
02552         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.loadPrefs();
02553 } <span class="keywordflow">catch</span>(e) {};
</pre></div><div class="footer" align=center> 
	<address style="align: right;"><small>
		Generated on Sun Mar 13 18:06:29 2005 by doxygen </small></address>
	<a href="/website/main/contact.jsp" class="lnkblue">Contact Us</a> | <a href="/website/main/employment.jsp" class="lnkblue">Employment</a> 
	<br>
	<br>
	&copy; 2004 <strong>Zapatec, Inc.</strong>

</div>
</body>
</html>
